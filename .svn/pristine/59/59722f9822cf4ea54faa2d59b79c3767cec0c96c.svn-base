(sentinel::auth-required)

(shield::validate form
	(shield::field name
		required: false
		pattern: name
		min-length: 4
	)

	(shield::field username
		required: false
		pattern: email
		min-length: 8
		max-length: 128
		check:username: (isnull (db::scalar `SELECT user_id FROM ##users WHERE user_id!={session.user.user_id} AND username={escape {formData.username}}`))
	)

	(shield::field email
		required: false
		pattern: email
	)
)

(db::update ##users `user_id={session.user.user_id}` (form))

(sentinel::reload)

(&
	response: (int 200)
	message: (strings.@messages.msg_data_saved)
	data: ((call 'account.get').data)
)
