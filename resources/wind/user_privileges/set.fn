(sentinel::privilege-required admin)

(shield::validate
	(shield::field id
		required: true
		pattern: integer
	)

	(shield::field privileges
		presence: true
		default: 0
		pattern: integer-list
	)
)

(db::exec `
	UPDATE ##user_privileges SET tag=1 WHERE user_id={id}
`)

(? (isnotnull (privileges))
	(db::exec `
		INSERT INTO ##user_privileges (user_id, privilege_id)
		SELECT {id}, privilege_id FROM ##privileges WHERE privilege_id IN ({privileges})
		ON DUPLICATE KEY UPDATE tag=0
	`)
)

(db::exec `
	DELETE FROM ##user_privileges WHERE user_id={id} AND tag=1
`)

(&)
